<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BFIDCLPC Store Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            /* হালকা গ্রিন এবং রেড মিশ্রণ (খুবই সফট) */
            background: linear-gradient(135deg, #f0f7f4 0%, #fdf5f5 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #1a3a2a;
        }

        /* ব্যাকগ্রাউন্ড জলছাপ লোগো */
        body::before {
            content: "";
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 280px;
            height: 280px;
            background-image: url('https://i.ibb.co/VWVX57D/BFIDC-Logo.jpg');
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.04; 
            z-index: -1;
            pointer-events: none;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease-in; }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.03);
        }
        
        .nav-active {
            background: #014c22 !important;
            color: white !important;
        }
    </style>
</head>
<body class="pb-24">

    <header class="bg-[#014c22] text-white pt-10 pb-16 shadow-lg rounded-b-[40px] text-center">
        <div class="flex flex-col items-center">
            <div class="bg-white p-1 rounded-2xl shadow-xl mb-3 w-20 h-20 flex items-center justify-center border-2 border-yellow-400">
                <img src="https://i.ibb.co/VWVX57D/BFIDC-Logo.jpg" alt="Logo" class="w-full h-full object-contain rounded-xl">
            </div>
            <h1 class="text-2xl font-black tracking-tight">BFIDCLPC STORE</h1>
            <p class="text-yellow-400 text-[8px] font-bold tracking-[4px] uppercase opacity-80">Inventory Management</p>
        </div>
    </header>

    <nav class="sticky top-4 z-50 mx-6 -mt-8 glass-card rounded-2xl flex p-1 border border-white">
        <button onclick="showTab('in')" id="btn-in" class="flex-1 py-3 text-[10px] font-bold rounded-xl nav-active">
            <i class="fa-solid fa-plus-circle text-lg mb-1 block"></i> ইনকামিং
        </button>
        <button onclick="showTab('out')" id="btn-out" class="flex-1 py-3 text-[10px] font-bold rounded-xl text-slate-500">
            <i class="fa-solid fa-minus-circle text-lg mb-1 block"></i> আউটগোয়িং
        </button>
        <button onclick="showTab('inv')" id="btn-inv" class="flex-1 py-3 text-[10px] font-bold rounded-xl text-slate-500">
            <i class="fa-solid fa-chart-line text-lg mb-1 block"></i> রিপোর্ট
        </button>
    </nav>

    <main class="p-5 max-w-lg mx-auto space-y-6">
        
        <section id="stock-in" class="tab-content active">
            <div class="glass-card p-6 rounded-3xl">
                <h2 class="text-[#014c22] font-bold text-md mb-4 flex items-center gap-2">মালামাল এন্ট্রি করুন</h2>
                <div class="space-y-4">
                    <input type="text" id="inName" placeholder="মালামালের নাম" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:border-[#014c22]">
                    <div class="grid grid-cols-2 gap-3">
                        <input type="number" id="inPrice" placeholder="দর (৳)" class="w-full p-4 bg-slate-50 border rounded-2xl">
                        <input type="number" id="inQty" placeholder="পরিমাণ" class="w-full p-4 bg-slate-50 border rounded-2xl">
                    </div>
                    <input type="text" id="inSection" placeholder="সেকশন/ডিপো" class="w-full p-4 bg-slate-50 border rounded-2xl">
                    <input type="date" id="inDate" class="w-full p-4 bg-slate-50 border rounded-2xl">
                    <button onclick="addStockIn()" class="w-full bg-[#014c22] text-white py-4 rounded-2xl font-bold shadow-lg">ডাটা সেভ করুন</button>
                </div>
            </div>
        </section>

        <section id="stock-out" class="tab-content">
            <div class="glass-card p-6 rounded-3xl">
                <h2 class="text-red-700 font-bold text-md mb-4">মালামাল ইস্যু/খরচ</h2>
                <div class="space-y-4">
                    <select id="outName" class="w-full p-4 bg-slate-50 border rounded-2xl font-bold"></select>
                    <input type="number" id="outQty" placeholder="ইস্যু পরিমাণ" class="w-full p-4 bg-slate-50 border rounded-2xl">
                    <input type="text" id="outSection" placeholder="গ্রহীতা বিভাগ" class="w-full p-4 bg-slate-50 border rounded-2xl">
                    <input type="date" id="outDate" class="w-full p-4 bg-slate-50 border rounded-2xl">
                    <button onclick="addStockOut()" class="w-full bg-red-700 text-white py-4 rounded-2xl font-bold">ইস্যু কনফার্ম করুন</button>
                </div>
            </div>
        </section>

        <section id="inventory" class="tab-content">
            <div class="glass-card rounded-3xl overflow-hidden border border-slate-100">
                <div class="bg-[#014c22] p-5 flex justify-between items-center text-white">
                    <h3 class="font-bold text-sm">স্টক রিপোর্ট</h3>
                    <span id="totalValue" class="text-lg font-black text-yellow-400"></span>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-[11px]">
                        <thead class="bg-slate-50 border-b">
                            <tr class="text-[#014c22]">
                                <th class="p-3 text-center">SL</th>
                                <th class="p-3 text-left">সেকশন</th>
                                <th class="p-3 text-left">বিবরণ</th>
                                <th class="p-3 text-center">মজুদ</th>
                                <th class="p-3 text-right">মূল্য</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryBody" class="divide-y divide-slate-100 bg-white/50"></tbody>
                    </table>
                </div>
                <div class="p-5">
                    <button onclick="downloadCSV()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold">EXCEL ডাউনলোড</button>
                </div>
            </div>
        </section>
    </main>

    <script>
        let db = JSON.parse(localStorage.getItem('bfidc_v10')) || { in: [], out: [] };

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(s => s.classList.remove('active'));
            document.getElementById('stock-' + id).classList.add('active');
            document.querySelectorAll('nav button').forEach(b => {
                b.classList.remove('nav-active');
                b.classList.add('text-slate-500');
            });
            document.getElementById('btn-' + id).classList.add('nav-active');
            if(id === 'out') updateOutSelect();
            if(id === 'inv') updateInventory();
        }

        document.getElementById('inDate').valueAsDate = new Date();
        document.getElementById('outDate').valueAsDate = new Date();

        function addStockIn() {
            const data = {
                name: document.getElementById('inName').value.trim(),
                price: parseFloat(document.getElementById('inPrice').value),
                qty: parseFloat(document.getElementById('inQty').value),
                section: document.getElementById('inSection').value.trim() || 'Main Store',
                date: document.getElementById('inDate').value
            };
            if(!data.name || isNaN(data.qty)) return alert("সঠিক তথ্য দিন!");
            db.in.push(data); save();
            alert("সফলভাবে যোগ হয়েছে!");
            document.getElementById('inName').value = ""; document.getElementById('inPrice').value = ""; document.getElementById('inQty').value = "";
        }

        function updateOutSelect() {
            const select = document.getElementById('outName');
            const items = [...new Set(db.in.map(i => i.name))];
            select.innerHTML = items.length ? items.map(i => `<option value="${i}">${i}</option>`).join('') : '<option disabled>মালামাল নেই</option>';
        }

        function addStockOut() {
            const data = {
                name: document.getElementById('outName').value,
                qty: parseFloat(document.getElementById('outQty').value),
                section: document.getElementById('outSection').value,
                date: document.getElementById('outDate').value
            };
            if(!data.qty || isNaN(data.qty)) return alert("পরিমাণ লিখুন!");
            db.out.push(data); save();
            alert("খরচ রেকর্ড হয়েছে!");
            document.getElementById('outQty').value = "";
        }

        function updateInventory() {
            const table = document.getElementById('inventoryBody');
            table.innerHTML = "";
            let itemNames = [...new Set(db.in.map(i => i.name))];
            let grandTotal = 0;

            itemNames.forEach((name, index) => {
                const tin = db.in.filter(i => i.name === name).reduce((sum, i) => sum + i.qty, 0);
                const tout = db.out.filter(i => i.name === name).reduce((sum, i) => sum + i.qty, 0);
                const info = db.in.findLast(i => i.name === name);
                let bal = tin - tout; let val = bal * info.price;
                grandTotal += val;
                
                table.innerHTML += `
                    <tr>
                        <td class="p-3 text-center text-slate-400">${index+1}</td>
                        <td class="p-3 font-bold text-[#014c22]">${info.section}</td>
                        <td class="p-3">${name}</td>
                        <td class="p-3 text-center font-black ${bal < 5 ? 'text-red-600 bg-red-50' : ''}">${bal}</td>
                        <td class="p-3 text-right font-bold">৳${val.toLocaleString()}</td>
                    </tr>`;
            });
            document.getElementById('totalValue').innerText = "৳" + grandTotal.toLocaleString();
        }

        function save() { localStorage.setItem('bfidc_v10', JSON.stringify(db)); }

        function downloadCSV() {
            let csv = "\ufeffনং,সেকশন,মালামাল,মজুদ,মূল্য\n";
            let itemNames = [...new Set(db.in.map(i => i.name))];
            itemNames.forEach((name, idx) => {
                const tin = db.in.filter(i => i.name === name).reduce((sum, i) => sum + i.qty, 0);
                const tout = db.out.filter(i => i.name === name).reduce((sum, i) => sum + i.qty, 0);
                const info = db.in.findLast(i => i.name === name);
                csv += `${idx+1},${info.section},${name},${tin-tout},${(tin-tout)*info.price}\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "BFIDC_Report.csv";
            link.click();
        }
    </script>
</body>
</html>
